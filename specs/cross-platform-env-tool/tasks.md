# 実装計画

- [x] 1. プロジェクト構造とコア基盤の設定
  - 新しいモジュール構造のディレクトリを作成し、基本的なインターフェースを定義する
  - カスタム例外クラスとセキュリティユーティリティの基盤を実装する
  - _要件: 1.1, 6.1, 7.1_

- [x] 2. セキュアなコマンド実行システムの実装
  - CommandExecutorクラスを実装し、許可リスト方式とサニタイゼーション機能を追加する
  - セキュリティバリデーターを実装してコマンドインジェクション攻撃を防ぐ
  - コマンド実行のユニットテストを作成し、セキュリティ機能を検証する
  - _要件: 6.1, 6.2, 6.3, 6.4_

- [x] 3. プラットフォーム検出とデータフォーマッターの実装
  - PlatformDetectorクラスを実装してOS自動検出機能を追加する
  - DataFormatterクラスを実装してプラットフォーム固有のデータを統一フォーマットに変換する
  - プラットフォーム検出のテストを各OS環境で実行する
  - _要件: 1.1, 1.2, 1.3_

- [x] 4. ハードウェア情報収集の実装
  - HardwareCollectorクラスを実装してCPU、RAM、GPU情報を収集する
  - 既存のformat_cpu_windows、format_ram_windows関数を新しいアーキテクチャに統合する
  - プラットフォーム固有のハードウェア情報取得コマンドを安全に実行する
  - ハードウェア情報収集のユニットテストを作成する
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [x] 5. OS情報収集の実装
  - OSCollectorクラスを実装してOS詳細情報を収集する
  - 既存のget_detailed_windows_info、get_detailed_linux_info、get_detailed_macos_info関数を統合する
  - OS情報収集のユニットテストを作成し、各プラットフォームでの動作を検証する
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [x] 6. 設定管理システムの実装
  - ConfigManagerクラスを実装してconfig.jsonファイルの読み込みと検証を行う
  - デフォルトソフトウェア定義を別モジュールに分離する
  - 設定ファイルのスキーマ検証とエラーハンドリングを実装する
  - 設定管理のユニットテストを作成する
  - _要件: 8.1, 8.2, 8.4_

- [x] 7. ソフトウェア情報収集の実装
  - SoftwareCollectorクラスを実装してソフトウェアバージョン情報を収集する
  - 既存のload_software_from_config関数を新しいアーキテクチャに統合する
  - カスタムソフトウェア定義の安全な実行機能を実装する
  - ソフトウェア情報収集のユニットテストを作成する
  - _要件: 4.1, 4.2, 4.3, 4.4, 8.3_

- [x] 8. ライブラリAPIの実装
  - EnveilAPIクラスを実装してライブラリとしての主要インターフェースを提供する
  - 各情報収集機能を個別に呼び出せる関数を実装する
  - 構造化されたデータ（辞書形式）を返すAPIを作成する
  - ライブラリAPIのユニットテストを作成する
  - _要件: 7.1, 7.2, 7.4_

- [x] 9. コマンドライン引数処理の改善
  - 既存のmain.py関数を新しいアーキテクチャに適合させる
  - --hardware、--os、--softwareフラグの処理を改善する
  - 複数フラグの組み合わせ処理を実装する
  - コマンドライン引数処理のテストを作成する
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 10. エラーハンドリングとロギングの実装
  - カスタム例外クラス階層を完成させる
  - グレースフルデグラデーション機能を実装する
  - 詳細なログ機能とユーザーフレンドリーなエラーメッセージを追加する
  - エラーハンドリングの統合テストを作成する
  - _要件: 7.4, 6.4_

- [x] 11. パフォーマンス最適化の実装
  - 並列実行機能を実装して独立した情報収集を高速化する
  - 重い処理結果のキャッシュ機能を追加する
  - コマンド実行のタイムアウト機能を実装する
  - パフォーマンステストを作成して最適化効果を検証する
  - _要件: 1.1, 1.3_

- [x] 12. 統合テストとセキュリティテストの実装
  - プラットフォーム固有のコマンド実行の統合テストを作成する
  - コマンドインジェクション攻撃の防御テストを実装する
  - 不正な設定ファイルの処理テストを作成する
  - 実際の環境での動作テストを各プラットフォームで実行する
  - _要件: 6.1, 6.2, 6.3, 6.4_

- [x] 13. パッケージングとドキュメントの更新
  - pyproject.tomlファイルを更新してライブラリとしての依存関係を定義する
  - __init__.pyファイルを更新して新しいAPIを公開する
  - pipインストール可能なパッケージ構成を完成させる
  - ライブラリ使用例とAPIドキュメントを作成する
  - _要件: 7.3_


- [ ] 14. クロスプラットフォーム対応の強化 (macOS / Linux)
  - macOSでのハードウェア情報収集機能を実装する
    - `sysctl` を使用してRAM総量を取得するロジックを追加
    - `system_profiler` を使用してGPU名とVRAMを取得するロジックを追加
    - `sysctl` を使用したCPU情報取得の安定性を向上
    - 新しいmacOS用コマンドを許可リスト (`api.py`) に追加
  - Linuxでの情報収集の堅牢性を向上させる
    - OS情報取得時に `/etc/os-release` ファイルへのフォールバックを実装
    - RAM情報取得をバイト単位 (`free -b`) で行い、GBへの変換をPython側で実行するよう変更
  - クロスプラットフォーム対応のテストを追加する
    - macOS/Linux固有の情報収集ロジックに対するユニットテストを作成
    - 実際のmacOSおよび複数のLinuxディストリビューション環境で統合テストを実施
  - _要件: 1.1, 1.3, 2.1, 2.2, 2.3, 3.1_